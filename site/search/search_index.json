{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Arista EVPN/VXLAN Containerlab Lab","text":"<p>GitHub Pages Version</p> <p>Split Fabric &amp; Management Labs with Real Traffic Visibility</p> <p>This repository provides a production-grade containerlab design implementing an Arista EVPN/VXLAN fabric with a separate management / observability stack. The two labs are cleanly separated but interconnected using: - a shared Docker management network (<code>clab-mgmt</code>) - a shared Linux bridge tap (<code>br-fabric-tap</code>) for real packet capture</p> <p>Designed and tested for macOS + OrbStack + Docker + containerlab.</p>"},{"location":"#table-of-contents","title":"Table of Contents","text":"<ul> <li>Architecture Overview</li> <li>Topology Diagram</li> <li>Repository Structure</li> <li>OrbStack Prerequisites</li> <li>Deployment Workflow</li> <li>stage_deploy.sh</li> <li>Observability Stack</li> <li>EOS SPAN Configuration</li> <li>CI Linting</li> <li>GitHub Pages</li> <li>Troubleshooting</li> </ul>"},{"location":"#architecture-overview","title":"Architecture Overview","text":""},{"location":"#fabric-lab","title":"Fabric Lab","text":"<ul> <li>2\u00d7 Arista spines (eBGP underlay, EVPN route-servers)</li> <li>4\u00d7 Arista leafs (VXLAN VTEPs)</li> <li>2\u00d7 Linux hosts (iperf traffic generation)</li> <li>VLAN 10 stretched via EVPN</li> <li>Anycast gateway (VARP)</li> <li>SPAN mirror to tap interface</li> </ul>"},{"location":"#management-lab","title":"Management Lab","text":"<ul> <li>gnmic (gNMI telemetry)</li> <li>Prometheus (metrics)</li> <li>Grafana (dashboards)</li> <li>Alloy + Loki (logs)</li> <li>Redis</li> <li>ntopng (packet analysis)</li> </ul>"},{"location":"#shared-components","title":"Shared Components","text":"<ul> <li>Docker network: <code>clab-mgmt</code></li> <li>Linux bridge: <code>br-fabric-tap</code> (host-based packet tap)</li> </ul>"},{"location":"#topology-diagram","title":"Topology Diagram","text":"<pre><code>                    +---------+       +---------+\n                    | spine1  |       | spine2  |\n                    +----+----+       +----+----+\n                         \\                 //\n                          \\               //\n                    +------+----+     +----+------+\n                    |   leaf1   |     |   leaf4   |\n                    | (VTEP)    |     | (VTEP)    |\n                    +---+---+---+     +---+---+---+\n                        |   |               |\n                     host1   |            host2\n                             |\n                       SPAN \u2192 Eth5\n                             |\n                    br-fabric-tap (Linux bridge)\n                             |\n                         ntopng\n</code></pre>"},{"location":"#repository-structure","title":"Repository Structure","text":"<pre><code>.\n\u251c\u2500\u2500 topology.fabric.yaml\n\u251c\u2500\u2500 topology.mgmt.yaml\n\u251c\u2500\u2500 stage_deploy.sh\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 .github/workflows/lint.yml\n\u251c\u2500\u2500 .yamllint\n\u251c\u2500\u2500 configs/\n\u2502   \u251c\u2500\u2500 fabric/\n\u2502   \u251c\u2500\u2500 gnmic/\n\u2502   \u251c\u2500\u2500 prometheus/\n\u2502   \u251c\u2500\u2500 grafana/\n\u2502   \u251c\u2500\u2500 alloy/\n\u2502   \u2514\u2500\u2500 loki/\n\u2514\u2500\u2500 persist/\n</code></pre>"},{"location":"#orbstack-prerequisites","title":"OrbStack Prerequisites","text":"<p>You must create a Linux bridge inside OrbStack's Linux environment.</p> <pre><code>orb create ubuntu clab\norb -m clab sudo ip link add br-fabric-tap type bridge\norb -m clab sudo ip link set br-fabric-tap up\n</code></pre> <p>Verify:</p> <pre><code>orb -m clab ip link show br-fabric-tap\n</code></pre> <p>Docker bridge options (<code>com.docker.network.bridge.*</code>) are not required.</p>"},{"location":"#deployment-workflow","title":"Deployment Workflow","text":"<p>The lab is deployed in two stages:</p> <ol> <li>Fabric lab</li> <li>EVPN convergence check</li> <li>Management lab</li> </ol> <p>All handled by <code>stage_deploy.sh</code>.</p>"},{"location":"#stage_deploysh","title":"stage_deploy.sh","text":""},{"location":"#deploy","title":"Deploy","text":"<pre><code>./stage_deploy.sh\n</code></pre>"},{"location":"#destroy","title":"Destroy","text":"<pre><code>./stage_deploy.sh destroy\n</code></pre>"},{"location":"#environment-variables","title":"Environment Variables","text":"Variable Description <code>MAX_WAIT</code> EVPN convergence timeout <code>POLL_INT</code> Poll interval <code>SKIP_TAP_BRIDGE=1</code> Skip bridge creation <code>NO_COLOR=1</code> Disable ANSI output"},{"location":"#observability-stack","title":"Observability Stack","text":"Service URL Grafana http://localhost:3000 Prometheus http://localhost:9090 ntopng http://localhost:3001 gnmic exporter http://localhost:9804 <p>Grafana default credentials: <code>admin / admin</code></p>"},{"location":"#eos-span-configuration","title":"EOS SPAN Configuration","text":"<p>Traffic will only reach ntopng if SPAN is configured on leaf1.</p> <p>Example:</p> <pre><code>monitor session 1\n  source interface Ethernet1\n  source interface Ethernet2\n  source interface Ethernet10\n  destination interface Ethernet5\n</code></pre> <p>You may also mirror VLANs or Port-Channels.</p>"},{"location":"#ci-linting","title":"CI Linting","text":"<p>GitHub Actions automatically validates: - YAML syntax (<code>yamllint</code>) - Shell scripts (<code>shellcheck</code>) - Trailing whitespace</p> <p>Workflow: <code>.github/workflows/lint.yml</code></p>"},{"location":"#github-pages","title":"GitHub Pages","text":"<p>This repository is ready for GitHub Pages.</p>"},{"location":"#enable-pages","title":"Enable Pages","text":"<ol> <li>Repo \u2192 Settings \u2192 Pages</li> <li>Source: <code>main</code> branch</li> <li>Folder: <code>/docs</code></li> </ol>"},{"location":"#files","title":"Files","text":"<pre><code>docs/\n\u2514\u2500\u2500 index.md\n</code></pre> <p>The Pages site renders the same content as this README.</p>"},{"location":"#troubleshooting","title":"Troubleshooting","text":"<p>ntopng shows no traffic - Verify SPAN config on leaf1 - Confirm <code>br-fabric-tap</code> exists - Ensure ntopng is capturing <code>eth1</code></p> <p>EVPN never converges - Check EOS configs - Validate underlay IP reachability</p>"},{"location":"#license","title":"License","text":"<p>MIT (or your preferred license)</p> <p>Happy labbing \ud83d\ude80</p>"},{"location":"evpn-control-plane/","title":"EVPN Control Plane (Deep Dive)","text":"<p>This document provides a complete, self-contained explanation of the EVPN/VXLAN control plane used in this lab. It is intended to be readable on its own and suitable for publication via MkDocs or GitHub Pages.</p>"},{"location":"evpn-control-plane/#scope-of-this-document","title":"Scope of This Document","text":"<p>This lab implements: - eBGP underlay (IPv4 unicast) - EVPN overlay (AFI/SAFI EVPN) - VXLAN data plane - Spine-based EVPN route-server design</p> <p>The sequence below matches what you will observe on Arista EOS using <code>show bgp</code>, <code>show vxlan</code>, and related commands.</p>"},{"location":"evpn-control-plane/#high-level-control-plane-flow","title":"High-Level Control Plane Flow","text":"<ol> <li>Physical links come up</li> <li>Underlay eBGP sessions establish</li> <li>EVPN address-family sessions establish</li> <li>VTEPs advertise VNIs (Type-3)</li> <li>Hosts trigger MAC/IP advertisements (Type-2)</li> <li>Data plane forwarding begins using VXLAN</li> </ol>"},{"location":"evpn-control-plane/#1-underlay-ebgp-session-establishment","title":"1. Underlay eBGP Session Establishment","text":"<p>The underlay provides IP reachability between VTEPs.</p> <pre><code>sequenceDiagram\n  autonumber\n  participant L as Leaf (e.g. leaf1)\n  participant S as Spine (e.g. spine1)\n\n  Note over L,S: Ethernet interface is UP, IP configured\n  L-&gt;&gt;S: TCP SYN (port 179)\n  S--&gt;&gt;L: TCP SYN/ACK\n  L-&gt;&gt;S: TCP ACK\n  L-&gt;&gt;S: BGP OPEN (ASN, router-id, capabilities)\n  S--&gt;&gt;L: BGP OPEN\n  L-&gt;&gt;S: BGP KEEPALIVE\n  S--&gt;&gt;L: BGP KEEPALIVE\n  Note over L,S: Underlay BGP session = Established\n  L-&gt;&gt;S: UPDATE (IPv4 unicast routes: loopbacks, P2P)\n  S--&gt;&gt;L: UPDATE (IPv4 unicast routes)</code></pre>"},{"location":"evpn-control-plane/#validation-commands-eos","title":"Validation Commands (EOS)","text":"<pre><code>show ip bgp summary\nshow ip route\nshow interfaces status\n</code></pre>"},{"location":"evpn-control-plane/#2-evpn-address-family-establishment","title":"2. EVPN Address-Family Establishment","text":"<p>Once underlay BGP is established, the EVPN AFI/SAFI becomes active.</p> <pre><code>sequenceDiagram\n  autonumber\n  participant L as Leaf (VTEP)\n  participant S as Spine (EVPN Route Server)\n\n  Note over L,S: Underlay BGP already Established\n  L-&gt;&gt;S: UPDATE (Enable AFI/SAFI EVPN)\n  S--&gt;&gt;L: UPDATE (EVPN policy + RS behavior)\n  Note over L,S: EVPN neighbors show Estab\n  L-&gt;&gt;S: EVPN Type-3 (IMET) \u2013 VNI membership\n  S--&gt;&gt;L: Reflected Type-3 routes from other VTEPs</code></pre>"},{"location":"evpn-control-plane/#what-type-3-imet-means","title":"What Type-3 (IMET) Means","text":"<ul> <li>Signals that a VTEP participates in a VNI</li> <li>Enables BUM (broadcast, unknown unicast, multicast) handling</li> <li>Required before host MAC learning works correctly</li> </ul>"},{"location":"evpn-control-plane/#validation-commands","title":"Validation Commands","text":"<pre><code>show bgp evpn summary\nshow bgp evpn route-type imet\n</code></pre>"},{"location":"evpn-control-plane/#3-host-learning-and-evpn-type-2-routes","title":"3. Host Learning and EVPN Type-2 Routes","text":"<p>When a host sends traffic, the leaf learns the MAC/IP and advertises it.</p> <pre><code>sequenceDiagram\n  autonumber\n  participant H1 as Host1\n  participant L1 as Leaf1 (VTEP)\n  participant RS as Spine (EVPN RS)\n  participant L4 as Leaf4 (VTEP)\n  participant H2 as Host2\n\n  H1-&gt;&gt;L1: ARP who-has 192.168.10.102?\n  L1-&gt;&gt;L1: Learn H1 MAC on access port (VLAN 10 / VNI)\n  L1-&gt;&gt;RS: EVPN Type-2 (MAC/IP for H1)\n  RS--&gt;&gt;L4: Reflect Type-2 (H1)\n  L4-&gt;&gt;L4: Install remote MAC/IP \u2192 VTEP (Leaf1)\n  L4-&gt;&gt;RS: EVPN Type-2 (MAC/IP for H2)\n  RS--&gt;&gt;L1: Reflect Type-2 (H2)\n  L1-&gt;&gt;L1: Install remote MAC/IP \u2192 VTEP (Leaf4)</code></pre>"},{"location":"evpn-control-plane/#what-type-2-routes-carry","title":"What Type-2 Routes Carry","text":"<ul> <li>MAC address</li> <li>Optional IP address</li> <li>VNI</li> <li>Next-hop = VTEP loopback IP</li> </ul>"},{"location":"evpn-control-plane/#validation-commands_1","title":"Validation Commands","text":"<pre><code>show bgp evpn route-type mac-ip\nshow mac address-table\nshow ip arp\n</code></pre>"},{"location":"evpn-control-plane/#4-vxlan-data-plane-forwarding","title":"4. VXLAN Data Plane Forwarding","text":"<p>Once both sides have MAC/IP mappings, traffic is forwarded using VXLAN.</p> <pre><code>sequenceDiagram\n  autonumber\n  participant L1 as Leaf1\n  participant L4 as Leaf4\n  participant H1 as Host1\n  participant H2 as Host2\n\n  H1-&gt;&gt;L1: Ethernet/IP packet to H2\n  L1-&gt;&gt;L1: Lookup MAC/IP \u2192 remote VTEP\n  L1-&gt;&gt;L4: VXLAN encapsulated packet (UDP/4789)\n  L4-&gt;&gt;L4: Decapsulate VXLAN\n  L4-&gt;&gt;H2: Deliver original Ethernet frame</code></pre>"},{"location":"evpn-control-plane/#outer-vs-inner-headers","title":"Outer vs Inner Headers","text":"<ul> <li>Inner frame: original host Ethernet/IP</li> <li>Outer packet: IP/UDP between VTEP loopbacks (UDP port 4789)</li> </ul>"},{"location":"evpn-control-plane/#common-failure-patterns","title":"Common Failure Patterns","text":""},{"location":"evpn-control-plane/#underlay-issues","title":"Underlay Issues","text":"<ul> <li>Interfaces down</li> <li>IP addressing errors</li> <li>ASN mismatch</li> <li>TCP/179 blocked</li> </ul>"},{"location":"evpn-control-plane/#evpn-issues","title":"EVPN Issues","text":"<ul> <li>EVPN AF not enabled</li> <li>Route-policy blocking EVPN routes</li> <li>Spine not acting as route server</li> <li>Missing Type-3 routes</li> </ul>"},{"location":"evpn-control-plane/#data-plane-issues","title":"Data Plane Issues","text":"<ul> <li>VLAN/VNI mismatch</li> <li>MTU too small for VXLAN</li> <li>Missing loopback reachability</li> <li>SPAN mirroring wrong interface (for visibility)</li> </ul>"},{"location":"evpn-control-plane/#quick-troubleshooting-checklist","title":"Quick Troubleshooting Checklist","text":"<pre><code>show ip bgp summary\nshow bgp evpn summary\nshow bgp evpn route-type imet\nshow bgp evpn route-type mac-ip\nshow vxlan vtep\nshow interfaces vxlan 1\n</code></pre>"},{"location":"evpn-control-plane/#notes-for-this-lab","title":"Notes for This Lab","text":"<ul> <li>Spines act as EVPN route servers</li> <li>Leafs act as VXLAN VTEPs</li> <li>Hosts generate continuous traffic to validate control + data plane</li> <li>SPAN on leaf1 mirrors traffic for ntopng visibility</li> </ul> <p>End of document</p>"},{"location":"fabric/","title":"Fabric Lab","text":"<p>This page documents the EVPN/VXLAN fabric lab defined in <code>topology.fabric.yaml</code>.</p>"},{"location":"fabric/#overview","title":"Overview","text":"<p>The fabric lab implements a Clos-style EVPN/VXLAN fabric using Arista cEOS:</p> <ul> <li>2\u00d7 Spines acting as EVPN route servers</li> <li>4\u00d7 Leafs acting as VXLAN VTEPs</li> <li>2\u00d7 Linux hosts for traffic generation</li> <li>Anycast gateway (VARP) for VLAN 10</li> <li>SPAN tap exporting real traffic to the management lab</li> </ul>"},{"location":"fabric/#nodes","title":"Nodes","text":""},{"location":"fabric/#spines","title":"Spines","text":"Node Role Notes <code>spine1</code> EVPN route server eBGP underlay <code>spine2</code> EVPN route server eBGP underlay"},{"location":"fabric/#leafs","title":"Leafs","text":"Node Role Notes <code>leaf1</code> VTEP + SPAN source SPAN destination on <code>Ethernet5</code> <code>leaf2</code> VTEP \u2014 <code>leaf3</code> VTEP \u2014 <code>leaf4</code> VTEP Anycast gateway peer"},{"location":"fabric/#hosts","title":"Hosts","text":"Host Attached To IP <code>host1</code> <code>leaf1:eth10</code> 192.168.10.101/24 <code>host2</code> <code>leaf4:eth10</code> 192.168.10.102/24"},{"location":"fabric/#topology","title":"Topology","text":"<pre><code>flowchart TB\n  spine1 --- leaf1\n  spine1 --- leaf2\n  spine1 --- leaf3\n  spine1 --- leaf4\n\n  spine2 --- leaf1\n  spine2 --- leaf2\n  spine2 --- leaf3\n  spine2 --- leaf4\n\n  host1 --- leaf1\n  host2 --- leaf4\n\n  leaf1 -- SPAN dest --&gt; tap((br-fabric-tap))</code></pre>"},{"location":"fabric/#underlay-overlay","title":"Underlay &amp; Overlay","text":""},{"location":"fabric/#underlay","title":"Underlay","text":"<ul> <li>eBGP between leafs and spines</li> <li>Each leaf has uplinks to both spines</li> <li>Point-to-point routed interfaces</li> </ul>"},{"location":"fabric/#overlay","title":"Overlay","text":"<ul> <li>EVPN address family</li> <li>VXLAN encapsulation</li> <li>VLAN 10 stretched across leafs</li> <li>Anycast gateway using VARP on <code>leaf1</code> and <code>leaf4</code></li> </ul>"},{"location":"fabric/#span-traffic-tap","title":"SPAN / Traffic Tap","text":"<p>To export real fabric traffic to ntopng:</p> <ul> <li><code>leaf1:Ethernet5</code> is connected to the host Linux bridge <code>br-fabric-tap</code></li> <li>Traffic is mirrored using EOS SPAN</li> </ul>"},{"location":"fabric/#example-eos-span-config","title":"Example EOS SPAN config","text":"<pre><code>monitor session 1\n  source interface Ethernet1\n  source interface Ethernet2\n  source interface Ethernet10\n  destination interface Ethernet5\n</code></pre> <p>You may also mirror: - VLAN 10 - Port-Channels - All interfaces</p> <p>\u26a0\ufe0f Without SPAN configured, ntopng will see no traffic.</p>"},{"location":"fabric/#validation","title":"Validation","text":"<p>Useful checks on leafs/spines:</p> <pre><code>show bgp evpn summary\nshow vxlan vtep\nshow ip route\n</code></pre>"},{"location":"fabric/#notes","title":"Notes","text":"<ul> <li>The fabric lab can be deployed and destroyed independently</li> <li>Management services are not part of this lab</li> <li><code>br-fabric-tap</code> must exist before deployment</li> </ul>"},{"location":"mgmt/","title":"Management Lab","text":"<p>This page documents the management / observability lab defined in <code>topology.mgmt.yaml</code>.</p> <p>The management lab is deployed after the fabric converges and is fully independent from the data plane, except for ntopng, which receives real mirrored traffic via a tap bridge.</p>"},{"location":"mgmt/#overview","title":"Overview","text":"<p>The management lab provides:</p> <ul> <li>Telemetry collection (gNMI)</li> <li>Metrics storage and visualization</li> <li>Centralized logging</li> <li>Flow and packet visibility using real fabric traffic</li> </ul> <p>All components connect via the Docker management network <code>clab-mgmt</code>.</p>"},{"location":"mgmt/#components","title":"Components","text":""},{"location":"mgmt/#gnmic","title":"gnmic","text":"<ul> <li>Collects gNMI telemetry from Arista devices</li> <li>Exports metrics in Prometheus format</li> <li>Acts as the single telemetry collector</li> </ul>"},{"location":"mgmt/#prometheus","title":"Prometheus","text":"<ul> <li>Scrapes gnmic metrics</li> <li>Stores time-series telemetry</li> <li>Feeds Grafana dashboards</li> </ul>"},{"location":"mgmt/#grafana","title":"Grafana","text":"<ul> <li>Visualizes metrics and logs</li> <li>Pre-provisioned dashboards and datasources</li> <li>Default credentials: <code>admin / admin</code></li> </ul>"},{"location":"mgmt/#alloy","title":"Alloy","text":"<ul> <li>Receives syslog from network devices</li> <li>Forwards logs to Loki</li> <li>Optional HTTP debug endpoint</li> </ul>"},{"location":"mgmt/#loki","title":"Loki","text":"<ul> <li>Log storage backend</li> <li>Queried by Grafana for log analysis</li> </ul>"},{"location":"mgmt/#redis","title":"Redis","text":"<ul> <li>Backend datastore for ntopng</li> <li>Required for ntopng operation</li> </ul>"},{"location":"mgmt/#ntopng","title":"ntopng","text":"<ul> <li>Network traffic analysis</li> <li>Captures real mirrored fabric traffic</li> <li>Web UI exposed via port forwarding</li> </ul>"},{"location":"mgmt/#network-interfaces","title":"Network Interfaces","text":""},{"location":"mgmt/#ntopng-interfaces","title":"ntopng Interfaces","text":"Interface Purpose <code>eth0</code> Management (Docker <code>clab-mgmt</code>) <code>eth1</code> Tap interface (<code>br-fabric-tap</code>) <p><code>eth1</code> receives mirrored packets from <code>leaf1</code> via SPAN.</p>"},{"location":"mgmt/#topology","title":"Topology","text":"<pre><code>flowchart LR\n  subgraph Fabric\n    leaf1[(leaf1)]\n  end\n\n  subgraph Host\n    tap((br-fabric-tap))\n  end\n\n  subgraph Mgmt\n    ntop[ntopng]\n    redis[Redis]\n    graf[Grafana]\n    prom[Prometheus]\n    gnmic[gnmic]\n    alloy[Alloy]\n    loki[Loki]\n  end\n\n  leaf1 -- SPAN --&gt; tap\n  tap --&gt; ntop\n  ntop --&gt; redis\n  gnmic --&gt; prom\n  prom --&gt; graf\n  alloy --&gt; loki</code></pre>"},{"location":"mgmt/#access-urls","title":"Access URLs","text":"Service URL Grafana http://localhost:3000 Prometheus http://localhost:9090 ntopng http://localhost:3001 gnmic exporter http://localhost:9804"},{"location":"mgmt/#notes","title":"Notes","text":"<ul> <li>The management lab can be redeployed independently</li> <li>Restarting management containers does not impact the fabric</li> <li>ntopng visibility depends entirely on EOS SPAN configuration</li> </ul>"},{"location":"ntopng/","title":"ntopng Usage","text":"<p>This page explains how ntopng is used in this lab to analyze real mirrored fabric traffic.</p>"},{"location":"ntopng/#interface-model","title":"Interface Model","text":"<p>In this design:</p> Interface Purpose <code>eth0</code> Management (<code>clab-mgmt</code>) <code>eth1</code> Tap (<code>br-fabric-tap</code>) <p>ntopng is started with:</p> <p>```bash ntopng --community --redis redis -i eth1 --disable-autologout</p>"},{"location":"operations/","title":"Deploy &amp; Operations","text":"<p>This page documents how to deploy, monitor, and destroy the labs using <code>stage_deploy.sh</code>.</p>"},{"location":"operations/#script-overview","title":"Script Overview","text":"<p><code>stage_deploy.sh</code> performs a staged deployment:</p> <ol> <li>Deploys the fabric lab</li> <li>Waits for EVPN BGP convergence</li> <li>Deploys the management lab</li> <li>Supports full teardown</li> </ol>"},{"location":"operations/#usage","title":"Usage","text":""},{"location":"operations/#deploy-default","title":"Deploy (default)","text":"<pre><code>./stage_deploy.sh\n</code></pre> <p>Equivalent to:</p> <pre><code>./stage_deploy.sh topology.fabric.yaml topology.mgmt.yaml\n</code></pre>"},{"location":"operations/#destroy-both-labs","title":"Destroy both labs","text":"<pre><code>./stage_deploy.sh destroy\n</code></pre> <p>Or explicitly:</p> <pre><code>./stage_deploy.sh destroy topology.fabric.yaml topology.mgmt.yaml\n</code></pre>"},{"location":"operations/#what-happens-during-deploy","title":"What Happens During Deploy","text":""},{"location":"operations/#stage-1-fabric","title":"Stage 1 \u2013 Fabric","text":"<ul> <li>Deploys <code>topology.fabric.yaml</code></li> <li>Starts spines, leafs, and hosts</li> <li>No management containers are started yet</li> </ul>"},{"location":"operations/#evpn-convergence-check","title":"EVPN Convergence Check","text":"<ul> <li>Polls all spines and leafs</li> <li>Runs <code>show bgp evpn summary</code></li> <li>Waits until all neighbors are <code>Estab</code></li> <li>Displays a live progress bar</li> <li>Times out safely if convergence fails</li> </ul>"},{"location":"operations/#stage-2-management","title":"Stage 2 \u2013 Management","text":"<ul> <li>Deploys <code>topology.mgmt.yaml</code></li> <li>Starts telemetry, logging, and ntopng</li> <li>ntopng immediately begins sniffing fabric traffic</li> </ul>"},{"location":"operations/#environment-variables","title":"Environment Variables","text":"Variable Description Default <code>MAX_WAIT</code> EVPN convergence timeout (seconds) <code>300</code> <code>POLL_INT</code> Poll interval (seconds) <code>10</code> <code>SKIP_TAP_BRIDGE</code> Skip bridge creation check <code>0</code> <code>NO_COLOR</code> Disable ANSI colors <code>0</code> <p>Example:</p> <pre><code>MAX_WAIT=600 POLL_INT=15 ./stage_deploy.sh\n</code></pre>"},{"location":"operations/#common-operations","title":"Common Operations","text":""},{"location":"operations/#check-container-status","title":"Check container status","text":"<pre><code>docker ps\n</code></pre>"},{"location":"operations/#check-evpn-on-a-leaf","title":"Check EVPN on a leaf","text":"<pre><code>docker exec clab-arista-evpn-vxlan-fabric-leaf1   Cli -c \"show bgp evpn summary\"\n</code></pre>"},{"location":"operations/#restart-management-lab-only","title":"Restart management lab only","text":"<pre><code>clab destroy -t topology.mgmt.yaml --cleanup\nclab deploy -t topology.mgmt.yaml\n</code></pre>"},{"location":"operations/#failure-modes","title":"Failure Modes","text":""},{"location":"operations/#evpn-does-not-converge","title":"EVPN does not converge","text":"<ul> <li>Check underlay reachability</li> <li>Verify EOS configs</li> <li>Script proceeds to management deploy after timeout</li> </ul>"},{"location":"operations/#ntopng-sees-no-traffic","title":"ntopng sees no traffic","text":"<ul> <li>Verify SPAN config on <code>leaf1</code></li> <li>Confirm <code>br-fabric-tap</code> exists and is UP</li> <li>Confirm ntopng is capturing <code>eth1</code></li> </ul>"},{"location":"operations/#safety-notes","title":"Safety Notes","text":"<ul> <li><code>destroy</code> always removes both labs</li> <li>Docker volumes under <code>persist/</code> are preserved</li> <li>Host Linux bridge is never deleted by the script</li> </ul>"},{"location":"troubleshooting/","title":"Troubleshooting","text":"<p>This page covers common issues encountered when deploying or operating the lab.</p>"},{"location":"troubleshooting/#ntopng-shows-no-traffic","title":"ntopng Shows No Traffic","text":""},{"location":"troubleshooting/#symptoms","title":"Symptoms","text":"<ul> <li>ntopng UI loads but shows zero flows</li> <li>Interfaces appear up, but no packets are seen</li> </ul>"},{"location":"troubleshooting/#checks","title":"Checks","text":"<ol> <li>Verify SPAN configuration on <code>leaf1</code>:    <pre><code>show monitor\n</code></pre></li> <li>Ensure <code>Ethernet5</code> is the SPAN destination</li> <li>Confirm the tap bridge exists:    <pre><code>orb -m clab ip link show br-fabric-tap\n</code></pre></li> <li>Confirm ntopng is capturing <code>eth1</code></li> <li>Verify link exists in both labs:</li> <li><code>leaf1:eth5</code> \u2192 <code>br-fabric-tap</code></li> <li><code>ntopng:eth1</code> \u2192 <code>br-fabric-tap</code></li> </ol>"},{"location":"troubleshooting/#evpn-does-not-converge","title":"EVPN Does Not Converge","text":""},{"location":"troubleshooting/#symptoms_1","title":"Symptoms","text":"<ul> <li>Deploy script stalls at EVPN wait stage</li> <li><code>show bgp evpn summary</code> shows neighbors not established</li> </ul>"},{"location":"troubleshooting/#checks_1","title":"Checks","text":"<pre><code>show ip bgp summary\nshow bgp evpn summary\nshow interfaces status\n</code></pre>"},{"location":"troubleshooting/#notes","title":"Notes","text":"<ul> <li>The deploy script will time out safely</li> <li>Management lab will still deploy after timeout</li> </ul>"},{"location":"troubleshooting/#containers-fail-to-start","title":"Containers Fail to Start","text":""},{"location":"troubleshooting/#checks_2","title":"Checks","text":"<pre><code>docker ps -a\ndocker logs &lt;container&gt;\n</code></pre> <ul> <li>Ensure <code>clab-mgmt</code> network exists</li> <li>Ensure required images are pulled</li> </ul>"},{"location":"troubleshooting/#bridge-errors","title":"Bridge Errors","text":""},{"location":"troubleshooting/#symptoms_2","title":"Symptoms","text":"<ul> <li>containerlab errors referencing <code>kind: bridge</code></li> <li>ntopng tap interface missing</li> </ul>"},{"location":"troubleshooting/#resolution","title":"Resolution","text":"<p>Ensure the bridge exists before deployment:</p> <pre><code>orb -m clab sudo ip link add br-fabric-tap type bridge\norb -m clab sudo ip link set br-fabric-tap up\n</code></pre>"},{"location":"troubleshooting/#cleanup-issues","title":"Cleanup Issues","text":""},{"location":"troubleshooting/#symptoms_3","title":"Symptoms","text":"<ul> <li>Containers remain after destroy</li> <li>Volumes persist unexpectedly</li> </ul>"},{"location":"troubleshooting/#resolution_1","title":"Resolution","text":"<pre><code>clab destroy -t topology.fabric.yaml --cleanup\nclab destroy -t topology.mgmt.yaml --cleanup\n</code></pre> <p>Persistent data under <code>persist/</code> is intentionally preserved.</p>"},{"location":"troubleshooting/#getting-help","title":"Getting Help","text":"<p>If something still doesn\u2019t look right: - Enable verbose output in the deploy script - Inspect EOS configs under <code>configs/fabric/</code> - Use <code>docker exec</code> to inspect containers interactively</p>"}]}