# ==========================================================
# gNMIc configuration
# - Arista EOS (OpenConfig)
# - BGP neighbor telemetry
# - Prometheus exporter
# ==========================================================

username: admin
password: admin
timeout: 10s
insecure: true
encoding: json_ietf
debug: true

# ----------------------------------------------------------
# Targets
# ----------------------------------------------------------
targets:
  spine1:
    address: spine1:6030
  spine2:
    address: spine2:6030
  leaf1:
    address: leaf1:6030
  leaf2:
    address: leaf2:6030
  leaf3:
    address: leaf3:6030
  leaf4:
    address: leaf4:6030

# ----------------------------------------------------------
# Subscriptions
# ----------------------------------------------------------
subscriptions:
  bgp_neighbors:
    mode: stream
    stream-mode: sample
    sample-interval: 5s
    paths:
      # ---------- Peer identity ----------
      - /network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor/state/peer-as
      - /network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor/state/peer-group

      # ---------- Session health ----------
      - /network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor/state/session-state
      - /network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor/state/established-transitions
      - /network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor/state/last-established
      - /network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor/state/uptime

      # ---------- Message counters ----------
      - /network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor/state/messages/sent/UPDATE
      - /network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor/state/messages/received/UPDATE
      - /network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor/state/messages/sent/NOTIFICATION
      - /network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor/state/messages/received/NOTIFICATION

      # ---------- Prefix counters ----------
      - /network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor/state/prefixes/received
      - /network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor/state/prefixes/accepted
      - /network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor/state/prefixes/sent

  bgp_global:
      mode: stream
      stream-mode: sample
      sample-interval: 10s
      paths:
        # overall BGP RIB/prefix count
        - /network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/global/state/total-prefixes
        # per AFI/SAFI prefix count (you currently have IPV4_UNICAST only)
        - /network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/global/afi-safis/afi-safi/state/afi-safi-name
        - /network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/global/afi-safis/afi-safi/state/total-prefixes

# ----------------------------------------------------------
# Outputs
# ----------------------------------------------------------
outputs:
  prometheus:
    type: prometheus
    listen: 0.0.0.0:9804
    path: /metrics
    metric-prefix: gnmic
    append-subscription-name: true
    strings-as-labels: true
    format: flat
    expiration: 10m
    export-timestamps: false
