!
! ==========================================================
! LEAF1
! - Role: VTEP + access leaf (host1 attached on Ethernet10)
! - Underlay: eBGP IPv4 unicast to spines (routed uplinks)
! - Overlay: eBGP EVPN to spine loopbacks
! - VXLAN: VLAN 10 <-> VNI 10010
! - Anycast GW: 192.168.10.1/24 on VLAN10 SVI (VARP)
! ==========================================================
!
service routing protocols model multi-agent
hostname leaf1
username admin privilege 15 secret 0 admin
aaa authorization exec default local
!
! --- MGMT VRF / Telemetry / SNMP ---
vrf instance MGMT
ip routing vrf MGMT
interface Management0
   vrf MGMT
   ip address 172.20.20.21/24
   no shutdown

ip route vrf MGMT 0.0.0.0/0 172.20.20.1

snmp-server vrf MGMT
snmp-server community lab ro
!
! --- Enable routing on default VRF (data-plane) ---
ip routing
!
! --- router general (global router-id baseline) ---
router general
   router-id ipv4 10.0.0.11
!
! --- Tenant VLAN definition ---
vlan 10
   name TENANT10
!
! ==========================================================
! Loopbacks
! - Loopback0: stable BGP identity + overlay peering endpoint
! - Loopback1: VTEP IP used as VXLAN source-interface
! ==========================================================
interface Loopback0
   ip address 10.0.0.11/32
interface Loopback1
   ip address 10.0.1.11/32
!
! ==========================================================
! Underlay uplinks to spines (2 uplinks total)
! ==========================================================
interface Ethernet1
   description to-spine1-eth1
   no switchport
   mtu 9214
   ip address 172.16.0.0/31
   no shutdown
interface Ethernet2
   description to-spine2-eth1
   no switchport
   mtu 9214
   ip address 172.16.0.4/31
   no shutdown
interface Ethernet5
   description SPAN_to_ntopng_eth1
   switchport
   spanning-tree portfast
   no lldp transmit
   no lldp receive
   no shutdown
!
! ==========================================================
! Host-facing access port
! ==========================================================
interface Ethernet10
   description host1_access
   switchport
   switchport access vlan 10
   spanning-tree portfast
   no shutdown
!
! ==========================================================
! Anycast gateway (VARP)
! ==========================================================
ip virtual-router mac-address 00:1c:73:00:00:10
interface Vlan10
   description TENANT10_ANYCAST_GW
   ip address virtual 192.168.10.1/24
!
! ==========================================================
! VXLAN
! ==========================================================
interface Vxlan1
   vxlan source-interface Loopback1
   vxlan udp-port 4789
   vxlan vlan 10 vni 10010
!
! ==========================================================
! BGP
! ==========================================================
router bgp 65101
   router-id 10.0.0.11
   !
   vlan 10
      rd 10.0.0.11:10010
      route-target import 65000:10010
      route-target export 65000:10010
      redistribute learned
   !
   neighbor UNDERLAY peer group
   neighbor UNDERLAY description UNDERLAY_EBGP_TO_SPINES
   neighbor UNDERLAY remote-as 65000
   neighbor UNDERLAY maximum-routes 12000
   !
   neighbor OVERLAY peer group
   neighbor OVERLAY description OVERLAY_EVPN_EBGP_TO_SPINES
   neighbor OVERLAY remote-as 65000
   neighbor OVERLAY update-source Loopback0
   neighbor OVERLAY ebgp-multihop 3
   neighbor OVERLAY send-community extended
   neighbor OVERLAY maximum-routes 12000
   !
   ! Underlay neighbors (spine routed interface IPs)
   neighbor 172.16.0.1 peer group UNDERLAY
   neighbor 172.16.0.5 peer group UNDERLAY
   !
   ! Overlay neighbors (spine Loopback0 IPs)
   neighbor 10.0.0.1 peer group OVERLAY
   neighbor 10.0.0.2 peer group OVERLAY
   !
   address-family ipv4
      neighbor UNDERLAY activate
      network 10.0.0.11/32
      network 10.0.1.11/32
   !
   address-family evpn
      neighbor OVERLAY activate
!
monitor session SPAN source Ethernet1
monitor session SPAN source Ethernet2
monitor session SPAN source Ethernet10
monitor session SPAN destination Ethernet5
!
management api http-commands
   protocol http
   !
   vrf MGMT
      no shutdown

management api gnmi
   transport grpc default
      vrf MGMT
   provider eos-native
