!
! ==========================================================
! LEAF4
! - Role: VTEP + access leaf (host2 attached on Ethernet10)
! - Anycast GW participant for VLAN 10 (VARP)
! ==========================================================
!
service routing protocols model multi-agent
hostname leaf4
username admin privilege 15 secret 0 admin
aaa authorization exec default local
!
vrf instance MGMT
ip routing vrf MGMT
!
interface Management0
   vrf MGMT
   ip address 172.20.20.24/24
   no shutdown
!
ip route vrf MGMT 0.0.0.0/0 172.20.20.1
!
snmp-server vrf MGMT
snmp-server community lab ro
!
ip routing
router general
   router-id ipv4 10.0.0.14
!
vlan 10
   name TENANT10
!
interface Loopback0
   ip address 10.0.0.14/32
interface Loopback1
   ip address 10.0.1.14/32
!
interface Ethernet1
   description to-spine1-eth7
   no switchport
   mtu 9214
   ip address 172.16.0.24/31
   no shutdown
interface Ethernet2
   description to-spine2-eth7
   no switchport
   mtu 9214
   ip address 172.16.0.28/31
   no shutdown
!
! --- Host access port (host2) ---
interface Ethernet10
   description host2_access
   switchport
   switchport access vlan 10
   spanning-tree portfast
   no shutdown
!
! --- Anycast GW (VARP) ---
ip virtual-router mac-address 00:1c:73:00:00:10
interface Vlan10
   description TENANT10_ANYCAST_GW
   ip address virtual 192.168.10.1/24
!
interface Vxlan1
   vxlan source-interface Loopback1
   vxlan udp-port 4789
   vxlan vlan 10 vni 10010
!
router bgp 65104
   router-id 10.0.0.14
   !
   vlan 10
      rd 10.0.0.14:10010
      route-target import 65000:10010
      route-target export 65000:10010
      redistribute learned
   !
   neighbor UNDERLAY peer group
   neighbor UNDERLAY description UNDERLAY_EBGP_TO_SPINES
   neighbor UNDERLAY remote-as 65000
   neighbor UNDERLAY maximum-routes 12000
   !
   neighbor OVERLAY peer group
   neighbor OVERLAY description OVERLAY_EVPN_EBGP_TO_SPINES
   neighbor OVERLAY remote-as 65000
   neighbor OVERLAY update-source Loopback0
   neighbor OVERLAY ebgp-multihop 3
   neighbor OVERLAY send-community extended
   neighbor OVERLAY maximum-routes 12000
   !
   neighbor 172.16.0.25 peer group UNDERLAY
   neighbor 172.16.0.29 peer group UNDERLAY
   !
   neighbor 10.0.0.1 peer group OVERLAY
   neighbor 10.0.0.2 peer group OVERLAY
   !
   address-family ipv4
      neighbor UNDERLAY activate
      network 10.0.0.14/32
      network 10.0.1.14/32
   !
   address-family evpn
      neighbor OVERLAY activate
!
management api http-commands
   protocol http
   no shutdown
   !
   vrf MGMT
      no shutdown
!
management api gnmi
   transport grpc default
      vrf MGMT
   provider eos-native
!
logging vrf MGMT host 172.20.20.216 1514
logging format rfc5424
logging level all informational