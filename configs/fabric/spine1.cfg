!
! ==========================================================
! SPINE1
! - Role: EVPN Route-Server/Transit for underlay + EVPN overlay
! - Underlay: eBGP IPv4 unicast to leaf routed uplinks
! - Overlay: eBGP EVPN (multihop) to leaf Loopback0
! ==========================================================
!
service routing protocols model multi-agent
!
hostname spine1
!
username admin privilege 15 secret 0 admin
!
aaa authorization exec default local
!
vrf instance MGMT
ip routing vrf MGMT
!
interface Management0
   vrf MGMT
   ip address 172.20.20.11/24
   no shutdown
!
ip route vrf MGMT 0.0.0.0/0 172.20.20.1
!
snmp-server vrf MGMT
snmp-server community lab ro
!
ip routing
!
router general
   router-id ipv4 10.0.0.1
!
interface Loopback0
   ip address 10.0.0.1/32
!
! ==========================================================
! Underlay uplinks (routed)
! ==========================================================
interface Ethernet1
   description to-leaf1-eth1
   no switchport
   mtu 9214
   ip address 172.16.0.1/31
   no shutdown
interface Ethernet3
   description to-leaf2-eth1
   no switchport
   mtu 9214
   ip address 172.16.0.9/31
   no shutdown
interface Ethernet5
   description to-leaf3-eth1
   no switchport
   mtu 9214
   ip address 172.16.0.17/31
   no shutdown
interface Ethernet7
   description to-leaf4-eth1
   no switchport
   mtu 9214
   ip address 172.16.0.25/31
   no shutdown
!
! --- Unused interfaces (shutdown) ---
interface Ethernet2
   description UNUSED
   shutdown
interface Ethernet4
   description UNUSED
   shutdown
interface Ethernet6
   description UNUSED
   shutdown
interface Ethernet8
   description UNUSED
   shutdown
!
! ==========================================================
! BGP
! ==========================================================
router bgp 65000
   router-id 10.0.0.1
   !
   neighbor UNDERLAY peer group
   neighbor UNDERLAY description UNDERLAY_EBGP_TO_LEAFS
   neighbor UNDERLAY maximum-routes 12000
   !
   neighbor OVERLAY peer group
   neighbor OVERLAY description OVERLAY_EVPN_EBGP_TO_LEAFS
   neighbor OVERLAY update-source Loopback0
   neighbor OVERLAY ebgp-multihop 3
   neighbor OVERLAY send-community extended
   neighbor OVERLAY maximum-routes 12000
   !
   ! --- UNDERLAY neighbors (leaf link IPs) ---
   neighbor 172.16.0.0 peer group UNDERLAY
   neighbor 172.16.0.8 peer group UNDERLAY
   neighbor 172.16.0.16 peer group UNDERLAY
   neighbor 172.16.0.24 peer group UNDERLAY
   !
   neighbor 172.16.0.0 remote-as 65101
   neighbor 172.16.0.8 remote-as 65102
   neighbor 172.16.0.16 remote-as 65103
   neighbor 172.16.0.24 remote-as 65104
   !
   ! --- OVERLAY neighbors (leaf Loopback0 IPs) ---
   neighbor 10.0.0.11 peer group OVERLAY
   neighbor 10.0.0.12 peer group OVERLAY
   neighbor 10.0.0.13 peer group OVERLAY
   neighbor 10.0.0.14 peer group OVERLAY
   !
   neighbor 10.0.0.11 remote-as 65101
   neighbor 10.0.0.12 remote-as 65102
   neighbor 10.0.0.13 remote-as 65103
   neighbor 10.0.0.14 remote-as 65104
   !
   address-family ipv4
      neighbor UNDERLAY activate
      network 10.0.0.1/32
   !
   address-family evpn
      neighbor OVERLAY activate
!
management api http-commands
   protocol http
   no shutdown
   !
   vrf MGMT
      no shutdown

management api gnmi
   transport grpc default
      vrf MGMT
   provider eos-native
!
logging vrf MGMT host 172.20.20.216 1514
logging format rfc5424
logging level all informational